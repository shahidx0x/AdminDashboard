import{u as se,a as ae,r as o,c as j,b as te,d as re,j as s,S as oe,e as u,M as b,f as ne,I as d,B,U}from"./index-5ccc964f.js";import{u as le,C as N}from"./index.esm-a48af042.js";import{g as de}from"./BrandServices-3275ca36.js";import{a as ce}from"./CategoryService-013ec7ca.js";import{u as ue}from"./ProductService-916e4bc5.js";import{g as ie}from"./SubCategoryServices-3c568209.js";import{u as me}from"./useToaster-f36faecc.js";import{P as pe}from"./Panel-7e2340e0.js";import{U as P}from"./Uploader-a8f11f84.js";import{S as y}from"./SelectPicker-962a459d.js";function ge(l,c){const i=new FileReader;i.onloadend=()=>{c(i.result)},i.readAsDataURL(l)}function Ie(){var C,w,I;const l=se(e=>e.user.user),c=me(),a=ae().state.myData,[L,m]=o.useState(!1),[_,p]=o.useState({product_image:a==null?void 0:a.product_image}),[$,S]=o.useState([]),[F,v]=o.useState(null),[M,R]=o.useState("brand"),[T,V]=o.useState(""),{data:g}=j(["brandsIdName",l.jwt],de),{data:x}=j(["categoryIdName","",l.jwt,M,-1],ce),{data:h}=j(["subCategoryIdName","",l.jwt,T,-1],ie),k=(C=x==null?void 0:x.data)==null?void 0:C.map(e=>({label:e==null?void 0:e.category_label,value:e._id})),E=(w=h==null?void 0:h.data)==null?void 0:w.map(e=>({label:e==null?void 0:e.subcategory_name,value:e._id})),z=[...((I=g==null?void 0:g.data)==null?void 0:I.map(e=>({label:e==null?void 0:e.name,value:e.id})))||["loading"]].map(e=>({label:e==null?void 0:e.label,value:e==null?void 0:e.value})),H=[...k||[{label:"No Category",value:"no-category"}]].map(e=>({label:e==null?void 0:e.label,value:e==null?void 0:e.value})),{register:n,control:f,reset:q,handleSubmit:A,formState:{errors:he}}=le({}),K=te(ue),[Q,G]=o.useState("No Brand"),[J,O]=o.useState("No Category"),[W,X]=o.useState("No Sub Category"),Y=e=>{e.fet_image=[...$],e.product_image=F,e.brand_name=Q,e.category_name=J,e.subcategory_name=W;let t=a._id;console.table(e),K.mutate({data:e,token:l.jwt,id:t},{onSuccess:r=>{c.push(s.jsx(b,{type:"success",children:"Product updated successfully"})),p(null),v(null),S(null),D(-1)},onError:r=>{c.push(s.jsx(b,{type:"error",children:"Product update failed !"}))}}),q()},Z=a.fet_image.map((e,t)=>({name:`${t}.png`,fileKey:t+1,url:e})),D=re();o.useState(null);const ee=e=>{U.delete(`${u.endpoints.host}/delete-image/${e}`).then(t=>U.patch(`${u.endpoints.host}/update/products/fet-img/${a._id}?imageUrl=${u.endpoints.host}/uploads/${e}`).then(r=>console.log("image deleted from product",r)).catch(r=>console.log(r))).catch(t=>console.log(t))};return s.jsx(s.Fragment,{children:s.jsx(oe,{justifyContent:"center",alignItems:"center",direction:"column",className:"mt-28 2xl:mt-5 ",style:{height:"100vh"},children:s.jsx(pe,{bordered:!0,className:"shadow-sm w-[48.5rem]",style:{background:"#fff"},header:s.jsx("h3",{className:"font-bold bg-indigo-700 p-8 text-2xl text-white rounded-lg",children:"Upadte Product Information"}),children:s.jsx("form",{onSubmit:A(Y),children:s.jsxs("div",{children:[s.jsx("div",{className:"flex justify-center items-center mb-5 ",children:s.jsx(P,{fileListVisible:!1,listType:"picture",action:`${u.endpoints.host}/upload`,onUpload:e=>{m(!0),ge(e.blobFile,t=>{p(r=>({...r,product_image:t}))})},onSuccess:(e,t)=>{m(!1),v(e.fileUrl)},onError:()=>{p(null),m(!1),c.push(s.jsx(b,{type:"error",children:"Upload failed"}))},children:s.jsxs("button",{type:"button",style:{width:150,height:150},children:[L&&s.jsx(ne,{backdrop:!0,center:!0}),_?s.jsx("img",{src:_.product_image,width:"100%",height:"150%",alt:"product_picture"}):s.jsx("img",{src:a==null?void 0:a.product_image,alt:"product_picture"})]})})}),s.jsx("div",{className:"mt-3",children:s.jsxs("div",{children:[s.jsx("p",{className:"font-bold",children:"Feature Image"}),s.jsx("div",{className:"flex",children:s.jsx(P,{disabled:!1,listType:"picture",defaultFileList:Z,action:`${u.endpoints.host}/upload`,onSuccess:e=>S(t=>[...t,e.fileUrl]),onRemove:e=>{ee(e.url.split("/")[4])}})})]})}),s.jsxs("div",{className:"flex gap-5 mt-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-bold",children:"Product Name"}),s.jsx(d,{required:!0,defaultValue:a.name,className:"w-[14.5rem]",...n("name")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-bold",children:"Select Company"}),s.jsx(N,{name:"brand_id",...n("brand_id"),control:f,render:({field:e})=>s.jsx(y,{searchable:!0,...e,placeholder:a.brand_name,size:"md",data:z,className:"w-[14.5rem]",onChange:(t,r)=>{e.onChange(t),R(t),G(r.target.innerHTML)},onBlur:()=>e.onBlur()})})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-bold",children:"Select Category"}),s.jsx(N,{name:"category_id",...n("category_id"),control:f,render:({field:e})=>s.jsx(y,{searchable:!0,...e,size:"md",placeholder:a.category_name,data:H,className:"w-[14.5rem]",onChange:(t,r)=>{e.onChange(t),O(r.target.innerHTML),V(t)},onBlur:()=>e.onBlur()})})]})]}),s.jsxs("div",{className:"flex gap-5 mt-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-bold",children:"Select Sub Category"}),s.jsx(N,{name:"sub_category_id",...n("subcategory_id"),control:f,render:({field:e})=>s.jsx(y,{searchable:!0,...e,placeholder:a.subcategory_name,size:"md",data:E,className:"w-[14.5rem]",onChange:(t,r)=>{X(r.target.innerHTML),e.onChange(t)},onBlur:()=>e.onBlur()})})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-bold",children:"Price"}),s.jsx(d,{className:"w-[14.5rem]",defaultValue:a==null?void 0:a.price,...n("price")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-bold",children:"Minimum Purchase"}),s.jsx(d,{className:"w-[14.5rem]",defaultValue:a==null?void 0:a.min_purchease,...n("min_purchease")})]})]}),s.jsxs("div",{className:"flex gap-5  mt-3 ",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-bold",children:"Maximum Purchase"}),s.jsx(d,{className:"w-[14.5rem]",defaultValue:a==null?void 0:a.max_purchease,...n("max_purchease")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-bold",children:"Discount"}),s.jsx(d,{className:"w-[14.5rem]",defaultValue:a==null?void 0:a.discount,...n("discount")})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-bold mt-3",children:"Description"}),s.jsx(d,{as:"textarea",...n("des"),rows:3,placeholder:""})]}),s.jsxs("div",{className:"mt-10 flex gap-2",children:[s.jsx(B,{appearance:"ghost",children:"Cancel"}),s.jsx(B,{type:"submit","aria-required":!0,appearance:"primary",className:"bg-blue-600 font-bold",children:"Update Product"})]})]})})})})})}export{Ie as default};
