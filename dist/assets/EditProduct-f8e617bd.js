import{u as le,a as ne,b as de,r,e as _,c as ce,d as ue,f as ie,j as a,S as me,P as pe,g as u,M as S,h as ge,I as d,C as N,B as M,a0 as R,a5 as be}from"./index-f476b377.js";import{g as he}from"./BrandServices-0b9ca06e.js";import{a as xe}from"./CategoryService-dda50c07.js";import{g as fe}from"./SubCategoryServices-4c27b250.js";import{U as E}from"./Uploader-861161a0.js";import{S as C}from"./SelectPicker-2e9fc169.js";function je(n,c){const i=new FileReader;i.onloadend=()=>{c(i.result)},i.readAsDataURL(n)}function Be(){var L,$,F;const n=le(e=>e.user.user),c=ne(),s=de().state.myData,[k,m]=r.useState(!1),[p,g]=r.useState({product_image:s==null?void 0:s.product_image}),[T,v]=r.useState([]),[z,w]=r.useState(null),[b,H]=r.useState(s.brand_id||""),[h,I]=r.useState(s.category_id||""),[ye,P]=r.useState(s.subcategory_id||""),[q,A]=r.useState(s.categoryName),[K,B]=r.useState(s.subCategoryName);r.useEffect(()=>{b!==s.brand_id&&(A("Select Category"),I(""),P(""),B("Select Subcategory"))},[b,s.brand_id]),r.useEffect(()=>{h!==s.category_id&&(P(""),B("Select Subcategory"),U("Not Sub Category"))},[h,s.category_id]);const{data:x}=_(["brandsIdName",n.jwt],he),{data:f}=_(["categoryIdName","",n.jwt,b,-1],xe),{data:j}=_(["subCategoryIdName","",n.jwt,h,-1],fe),Q=(L=f==null?void 0:f.data)==null?void 0:L.map(e=>({label:e==null?void 0:e.category_label,value:e._id})),G=($=j==null?void 0:j.data)==null?void 0:$.map(e=>({label:e==null?void 0:e.subcategory_name,value:e._id})),J=[...((F=x==null?void 0:x.data)==null?void 0:F.map(e=>({label:e==null?void 0:e.name,value:e.id})))||["loading"]].map(e=>({label:e==null?void 0:e.label,value:e==null?void 0:e.value})),O=[...Q||[{label:"No Category",value:"no-category"}]].map(e=>({label:e==null?void 0:e.label,value:e==null?void 0:e.value})),{register:l,control:y,reset:W,handleSubmit:X,formState:{errors:Se}}=ce({defaultValues:{brand_id:s.brand_id,category_id:s.category_id,subcategory_id:s.subcategory_id,brand_name:s.brand_name}}),Y=ue(be),[Z,D]=r.useState(s.brand_name),[ee,ae]=r.useState(s.category_name),[se,U]=r.useState(s.subcategory_name),te=e=>{e.fet_image=[...T],e.product_image=z||p.product_image,e.brand_name=Z,e.category_name=ee,e.subcategory_name=se;let t=s._id;Y.mutate({data:e,token:n.jwt,id:t},{onSuccess:o=>{c.push(a.jsx(S,{type:"success",children:"Product updated successfully"})),g(null),w(null),v(null),V(-1)},onError:o=>{c.push(a.jsx(S,{type:"error",children:"Product update failed !"}))}}),W()},re=s.fet_image.map((e,t)=>({name:`${t}.png`,fileKey:t+1,url:e})),V=ie();r.useState(null);const oe=e=>{R.delete(`${u.endpoints.host}/delete-image/${e}`).then(t=>R.patch(`${u.endpoints.host}/update/products/fet-img/${s._id}?imageUrl=${u.endpoints.host}/uploads/${e}`).then(o=>console.log("image deleted from product",o)).catch(o=>console.log(o))).catch(t=>console.log(t))};return a.jsx(a.Fragment,{children:a.jsx(me,{justifyContent:"center",alignItems:"center",direction:"column",className:"mt-28 2xl:mt-5 ",style:{height:"100vh"},children:a.jsx(pe,{bordered:!0,className:"shadow-sm w-[48.5rem]",style:{background:"#fff"},header:a.jsx("h3",{className:"font-bold bg-indigo-700 p-8 text-2xl text-white rounded-lg",children:"Upadte Product Information"}),children:a.jsx("form",{onSubmit:X(te),children:a.jsxs("div",{children:[a.jsx("div",{className:"flex justify-center items-center mb-5 ",children:a.jsx(E,{fileListVisible:!1,listType:"picture",action:`${u.endpoints.host}/upload`,onUpload:e=>{m(!0),je(e.blobFile,t=>{g(o=>({...o,product_image:t}))})},onSuccess:(e,t)=>{m(!1),w(e.fileUrl)},onError:()=>{g(null),m(!1),c.push(a.jsx(S,{type:"error",children:"Upload failed"}))},children:a.jsxs("button",{type:"button",style:{width:150,height:150},children:[k&&a.jsx(ge,{backdrop:!0,center:!0}),p?a.jsx("img",{src:p.product_image,width:"100%",height:"150%",alt:"product_picture"}):a.jsx("img",{src:s==null?void 0:s.product_image,alt:"product_picture"})]})})}),a.jsx("div",{className:"mt-3",children:a.jsxs("div",{children:[a.jsx("p",{className:"font-bold",children:"Feature Image"}),a.jsx("div",{className:"flex",children:a.jsx(E,{disabled:!1,listType:"picture",defaultFileList:re,action:`${u.endpoints.host}/upload`,onSuccess:e=>v(t=>[...t,e.fileUrl]),onRemove:e=>{oe(e.url.split("/")[4])}})})]})}),a.jsxs("div",{className:"flex gap-5 mt-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-bold",children:"Product Name"}),a.jsx(d,{required:!0,defaultValue:s.name,className:"w-[14.5rem]",...l("name")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-bold",children:"Select Company"}),a.jsx(N,{name:"brand_id",...l("brand_id"),control:y,defaultValue:s.brand_id,render:({field:e})=>a.jsx(C,{searchable:!0,...e,placeholder:s.brand_name,size:"md",data:J,className:"w-[14.5rem]",onChange:(t,o)=>{e.onChange(t),H(t),D(o.target.innerHTML)},onBlur:()=>e.onBlur()})})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-bold",children:"Select Category"}),a.jsx(N,{name:"category_id",...l("category_id"),control:y,defaultValue:s.category_id,render:({field:e})=>a.jsx(C,{searchable:!0,...e,size:"md",placeholder:q,data:O,className:"w-[14.5rem]",onChange:(t,o)=>{e.onChange(t),ae(o.target.innerHTML),I(t)},onBlur:()=>e.onBlur()})})]})]}),a.jsxs("div",{className:"flex gap-5 mt-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-bold",children:"Select Sub Category"}),a.jsx(N,{name:"sub_category_id",...l("subcategory_id"),control:y,defaultValue:s.subcategory_id,render:({field:e})=>a.jsx(C,{loading:!1,searchable:!0,...e,placeholder:K,size:"md",data:G,className:"w-[14.5rem]",onChange:(t,o)=>{U(o.target.innerHTML),e.onChange(t)},onBlur:()=>e.onBlur()})})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-bold",children:"Price"}),a.jsx(d,{className:"w-[14.5rem]",defaultValue:s==null?void 0:s.price,...l("price")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-bold",children:"Minimum Purchase"}),a.jsx(d,{className:"w-[14.5rem]",defaultValue:s==null?void 0:s.min_purchease,...l("min_purchease")})]})]}),a.jsxs("div",{className:"flex gap-5  mt-3 ",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-bold",children:"Maximum Purchase"}),a.jsx(d,{className:"w-[14.5rem]",defaultValue:s==null?void 0:s.max_purchease,...l("max_purchease")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-bold",children:"Discount"}),a.jsx(d,{className:"w-[14.5rem]",defaultValue:s==null?void 0:s.discount,...l("discount")})]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"font-bold mt-3",children:"Description"}),a.jsx(d,{as:"textarea",...l("des"),rows:3,placeholder:""})]}),a.jsxs("div",{className:"mt-10 flex gap-2",children:[a.jsx(M,{onClick:()=>V(-1),appearance:"ghost",children:"Cancel"}),a.jsx(M,{type:"submit","aria-required":!0,appearance:"primary",className:"bg-blue-600 font-bold",children:"Update Product"})]})]})})})})})}export{Be as default};
