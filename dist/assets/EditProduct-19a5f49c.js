import{u as M,a as be,b as _e,r,e as p,c as fe,d as xe,f as ye,j as t,S as je,P as Se,U as T,g as u,M as v,h as Ne,I as i,i as g,C as w,k,q as z,W as Ce,Q as ve}from"./index-3ef255cd.js";import{g as we}from"./BrandServices-14d7b73e.js";import{a as Pe}from"./CategoryService-f8739469.js";import{g as Ie}from"./SubCategoryServices-3924a627.js";import{R as H,t as Ue}from"./toolbar.config-2cd3acdc.js";function Be(l,c){const m=new FileReader;m.onloadend=()=>{c(m.result)},m.readAsDataURL(l)}function ze(){var F,L,$;const l=M(e=>e.user.user),c=be(),a=_e().state.myData,[A,h]=r.useState(!1),[b,_]=r.useState({product_image:a==null?void 0:a.product_image}),[Q,P]=r.useState([]),[K,I]=r.useState(null),[f,W]=r.useState(a.brand_id||""),[x,U]=r.useState(a.category_id||""),[Ve,B]=r.useState(a.subcategory_id||""),[G,J]=r.useState(a.categoryName),[O,V]=r.useState(a.subCategoryName),[d,X]=r.useState("Pices");r.useEffect(()=>{f!==a.brand_id&&(J("Select Category"),U(""),B(""),V("Select Subcategory"))},[f,a.brand_id]),r.useEffect(()=>{x!==a.category_id&&(B(""),V("Select Subcategory"),R("Not Sub Category"))},[x,a.category_id]);const{data:y}=p(["brandsIdName",l.jwt],we),{data:j}=p(["categoryIdName","",l.jwt,f,-1],Pe),{data:S}=p(["subCategoryIdName","",l.jwt,x,-1],Ie),Y=(F=j==null?void 0:j.data)==null?void 0:F.map(e=>({label:e==null?void 0:e.category_label,value:e._id})),Z=(L=S==null?void 0:S.data)==null?void 0:L.map(e=>({label:e==null?void 0:e.subcategory_name,value:e._id})),D=[...(($=y==null?void 0:y.data)==null?void 0:$.map(e=>({label:e==null?void 0:e.name,value:e.id})))||["loading"]].map(e=>({label:e==null?void 0:e.label,value:e==null?void 0:e.value})),ee=[...Y||[{label:"No Category",value:"no-category"}]].map(e=>({label:e==null?void 0:e.label,value:e==null?void 0:e.value})),{register:n,control:N,reset:te,handleSubmit:ae,formState:{errors:qe}}=fe({defaultValues:{brand_id:a.brand_id,category_id:a.category_id,subcategory_id:a.subcategory_id,brand_name:a.brand_name}}),se=xe(Ce),[re,oe]=r.useState(a.brand_name),[ne,le]=r.useState(a.category_name),[ce,R]=r.useState(a.subcategory_name),{data:C,status:Ee,refetch:Fe}=p(["unit-info",l.jwt],ve,{cacheTime:0}),de=[{label:"Pices",value:"Pices"},...((C==null?void 0:C.data)||[]).map(e=>({label:e.quantity+"/"+e.label,value:e.label+"/"+e.quantity}))];M(e=>e.settings);const[q,ue]=r.useState(H.createValueFromString(a.product_information,"html")),ie=e=>{e&&ue(e)},me=e=>{const s=q.toString("html");e.fet_image=[...Q],e.product_image=K||b.product_image,e.brand_name=re,e.category_name=ne,e.subcategory_name=ce,e.product_information=s,d==="Pices"&&(e.product_unit_type=d,e.product_unit_quantity=1),e.product_unit_type=d.split("/")[0]||a.product_unit_type,e.product_unit_quantity=Number(d.split("/")[1])||a.product_unit_quantity;let o=a._id;console.log(d),console.log(e),se.mutate({data:e,token:l.jwt,id:o},{onSuccess:he=>{c.push(t.jsx(v,{type:"success",children:"Product updated successfully"})),_(null),I(null),P(null),E(-1)},onError:he=>{c.push(t.jsx(v,{type:"error",children:"Product update failed !"}))}}),te()},pe=a.fet_image.map((e,s)=>({name:`${s}.png`,fileKey:s+1,url:e})),E=ye();r.useState(null);const ge=e=>{z.delete(`${u.endpoints.host}/delete-image/${e}`).then(s=>z.patch(`${u.endpoints.host}/update/products/fet-img/${a._id}?imageUrl=${u.endpoints.host}/uploads/${e}`).then(o=>console.log("image deleted from product",o)).catch(o=>console.log(o))).catch(s=>console.log(s))};return t.jsx(t.Fragment,{children:t.jsx(je,{justifyContent:"center",alignItems:"center",direction:"column",className:" 2xl:mt-5  ",style:{height:"100vh"},children:t.jsx(Se,{bordered:!0,className:"shadow-sm w-[48.5rem] mt-48  ",header:t.jsx("h3",{className:"font-bold bg-indigo-700 p-8 text-2xl text-white rounded-lg",children:"Upadte Product Information"}),children:t.jsx("form",{onSubmit:ae(me),children:t.jsxs("div",{children:[t.jsx("div",{className:"flex justify-center items-center mb-5 ",children:t.jsx(T,{fileListVisible:!1,listType:"picture",action:`${u.endpoints.host}/upload`,onUpload:e=>{h(!0),Be(e.blobFile,s=>{_(o=>({...o,product_image:s}))})},onSuccess:(e,s)=>{h(!1),I(e.fileUrl)},onError:()=>{_(null),h(!1),c.push(t.jsx(v,{type:"error",children:"Upload failed"}))},children:t.jsxs("button",{type:"button",style:{width:150,height:150},children:[A&&t.jsx(Ne,{backdrop:!0,center:!0}),b?t.jsx("img",{src:b.product_image,width:"100%",height:"150%",alt:"product_picture"}):t.jsx("img",{src:a==null?void 0:a.product_image,alt:"product_picture"})]})})}),t.jsx("div",{className:"mt-3",children:t.jsxs("div",{children:[t.jsx("p",{className:"font-bold",children:"Feature Image"}),t.jsx("div",{className:"flex",children:t.jsx(T,{disabled:!1,listType:"picture",defaultFileList:pe,action:`${u.endpoints.host}/upload`,onSuccess:e=>P(s=>[...s,e.fileUrl]),onRemove:e=>{ge(e.url.split("/")[4])}})})]})}),t.jsxs("div",{className:"flex gap-5 mt-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-bold",children:"Product Name"}),t.jsx(i,{required:!0,defaultValue:a.name,className:"w-[14.5rem]",...n("name")})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold",children:"Select Unit"}),t.jsx(g,{placeholder:a.product_unit_quantity+"/"+a.product_unit_type,className:"w-[12rem] 2xl:w-[14.5rem]",onChange:(e,s)=>X(e),searchable:!1,data:de})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold",children:"Select Company"}),t.jsx(w,{name:"brand_id",...n("brand_id"),control:N,defaultValue:a.brand_id,render:({field:e})=>t.jsx(g,{searchable:!0,...e,placeholder:a.brand_name,size:"md",data:D,className:"w-[14.5rem]",onChange:(s,o)=>{e.onChange(s),W(s),oe(o.target.innerHTML)},onBlur:()=>e.onBlur()})})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold",children:"Select Category"}),t.jsx(w,{name:"category_id",...n("category_id"),control:N,defaultValue:a.category_id,render:({field:e})=>t.jsx(g,{searchable:!0,...e,size:"md",placeholder:G,data:ee,className:"w-[14.5rem]",onChange:(s,o)=>{e.onChange(s),le(o.target.innerHTML),U(s)},onBlur:()=>e.onBlur()})})]})]}),t.jsxs("div",{className:"flex gap-5 mt-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-bold",children:"Select Sub Category"}),t.jsx(w,{name:"sub_category_id",...n("subcategory_id"),control:N,defaultValue:a.subcategory_id,render:({field:e})=>t.jsx(g,{loading:!1,searchable:!0,...e,placeholder:O,size:"md",data:Z,className:"w-[14.5rem]",onChange:(s,o)=>{R(o.target.innerHTML),e.onChange(s)},onBlur:()=>e.onBlur()})})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold",children:"Price"}),t.jsx(i,{className:"w-[14.5rem]",defaultValue:a==null?void 0:a.price,...n("price")})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold",children:"Minimum Purchase"}),t.jsx(i,{className:"w-[14.5rem]",defaultValue:a==null?void 0:a.min_purchease,...n("min_purchease")})]})]}),t.jsxs("div",{className:"flex gap-5  mt-3 ",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-bold",children:"Maximum Purchase"}),t.jsx(i,{className:"w-[14.5rem]",defaultValue:a==null?void 0:a.max_purchease,...n("max_purchease")})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold",children:"Discount"}),t.jsx(i,{className:"w-[14.5rem]",defaultValue:a==null?void 0:a.discount,...n("discount")})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold mt-3",children:"Description"}),t.jsx(H,{className:"mt-2",toolbarConfig:Ue,value:q,onChange:ie})]}),t.jsxs("div",{className:"mt-10 flex gap-2",children:[t.jsx(k,{onClick:()=>E(-1),appearance:"ghost",children:"Cancel"}),t.jsx(k,{type:"submit","aria-required":!0,appearance:"primary",className:"bg-blue-600 font-bold",children:"Update Product"})]})]})})})})})}export{ze as default};
